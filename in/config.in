################ config file for PENTrack ###############
# put comments after #

[GLOBAL]
# simtype: 1 => particles, 3 => Bfield, 4 => cut through BField, 7 => print geometry, 8 => print mr-drp for solid angle
# 9 => print integrated mr-drp for incident theta vs energy
simtype 1

# number of primary particles to be simulated
simcount 200

# max. simulation time [s]
simtime 10

# path of file containing materials, paths are assumed to be relative to this config file's path
materials_file materials.in

# secondaries: set to 1 to also simulate secondary particles (e.g. decay protons/electrons) [0/1]
secondaries 1


#cut through B-field at time t (simtype == 4) (x1 y1 z1  x2 y2 z2  x3 y3 z3 num1 num2 t)
#define cut plane by three points and number of sample points in direction 1->2/1->3
#	    x1 	  y1 	z1     	      	  x2  y2     z2  	  x3   y3    z3 	 num1   num2	   t

# For octupole cut
# BCutPlane   1.0  -0.054 -0.054    	  1.0   0.054  -0.054        1.0   -0.054  0.054      200    200	   1

# For coil cut
# BCutPlane   0.0   -0.05  0.000    	  2.0   -0.05  0.000        0.0   0.05  0.000      2001    3	   0

# For octupole + coil cut
# BCutPlane   0.0   0.000  0.000    	  2.0   0.030  0.040        2.0   0.000  0.000      2000    1	   0

# For spinflipper cut
# BCutPlane   0.980  -0.054 -0.054    	  0.980   0.054  -0.054        0.980   -0.054  0.054      200    200	   0



#parameters to be used for generating a 2d histogram for the mr diffuse reflection probability into a solid angle
#Param order: Fermi pot. [neV], Neut energy [neV], RMS roughness [nm], correlation length [nm], theta_i [0..pi/2]
#MRSolidAngleDRP 220 200 1E-9 25E-9 0.1

#parameters to be used for generating a 2d histogram of the integrated diffuse reflection probabilitites of the incident angle vs energy of a neutron
#Parameter order: Fermi potential of the material, RMS roughness [nm], Correlation length [nm], starting angle [0..pi/2], ending angle [0..pi/2],
#starting neutron energy [neV], ending neutron energy [neV]
#MRThetaIEnergy 54 2.5E-9 20E-9 0 1.570796327 0 1000

#Format used for logging output, can be "txt" for raw text, "ROOT" for ROOT trees and files, and "HDF5" for HDF5 files
# logtype ROOT
# logtype txt 
logtype HDF5


[GEOMETRY]
############# Solids the program will load ################
# Each solid has to be assigned unique ID and a material from above.b
# IDs have to be larger than 0, ID 1 will be assumed to be the default medium which is always present.
# Particles absorbed in a solid will be flagged with the ID of the solid.
# The ID also defines the order in which overlapping solids are handled (highest ID will be considered first).
# If paths to StL files are relative they have to be defined relative to this config file.
# Ignore times are pairs of times [s] in between the solid will be ignored, e.g. 100-200 500-1000.
#ID	STLfile    	    	      	 	     	material_name    ignore_times
# PENtrack_Test
1	ignored						default
2	STLs/tSPECT/aSPECT_tube.stl				PolishedSteel
3	STLs/tSPECT/halbach.stl					PolishedSteel
4	STLs/tSPECT/stabilisation_tubes.stl			PolishedSteel
5	STLs/tSPECT/store/detector_store.stl			PolishedSteel
6	STLs/tSPECT/store/foil_store.stl			PolishedSteel
7	STLs/tSPECT/store/SF_copper_store.stl			PolishedSteel
8	STLs/tSPECT/store/SF_tube_store.stl			PolishedSteel
9	STLs/tSPECT/store/SF_quartztube_store.stl		PolishedSteel
10	STLs/tSPECT/store/SF_quartztube1_store.stl		PolishedSteel
11	STLs/tSPECT/store/SF_seperation_foil_store.stl		PolishedSteel



[SOURCE]
############ sourcemodes ###############
# STLvolume: source volume is given by a STL file, particles are created in the space completely enclosed in the STL surface
# boxvolume: particle starting values are diced in the given parameter range (x,y,z) [m,m,m]
# cylvolume: particle starting values are diced in the given parameter range (r,phi,z) [m,degree,m]
# Volume source produce velocity vectors according to the given angular distributions below.
# If PhaseSpaceWeighting is set to 1 for volume sources the energy spectrum is interpreted as a total-energy spectrum.
## The probability to find a particle at a certain initial position is then weighted by the available phase space,
## i.e. proportional to the square root of the particle's kinetic energy.
#
# STLsurface: starting values are on surfaces in the given STL-volume
# cylsurface: starting values are on surfaces in the cylindrical volume given by parameter range (r,phi,z) [m,degree,m]
# Surface sources produce velocity vectors cosine(theta)-distributed around the surface normal.
# An additional Enormal [eV] can be defined. This adds an additional energy boost to the velocity component normal to the surface.
########################################

#sourcemode	STLsurface
#sourcemode	STLvolume
# sourcemode	cylvolume
sourcemode	boxvolume


#STLfile		sourcevolume.STL	# STL volume used for STLvolume/STLsurface source, path is assumed relative to this config file
#STLfile		source1.stl

### parameter ranges for sourcemode cylvolume/cylsurface/boxvolume
#			r_min	r_max	phi_min	phi_max	z_min	z_max (cylvolume/cylsurface)
# parameters 0	0		0		360		0.600	0.601

#		x_min	x_max	y_min	y_max	z_min	z_max	(boxvolume)
parameters	1.2	1.21	-0.005	0.005	-0.005	0.005
###

particle	neutron		# type of particle the source should create
ActiveTime	0.05			# time source is active for

### Optional params for a pulsed particle source. Requires ActiveTime > 0 and pulseGap > 0
pulseGap 0              # [s] Number of seconds between each pulse start
pulseWidth  0           # [s] Duration of a source pulse. If set to 0, each pulse becomes a delta function


Enormal		0					# give particles an energy boost normal to surface (surface sources only! see above)
PhaseSpaceWeighting	0			# weight initial particle density by available phase space (volume source only! see above)

### initial energy range [eV] and spectrum of particles
Emin 0e-9
Emax 50e-9
#Emin 100e-9 
#Emax 300e-9
#spectrum 1
spectrum sqrt(x)
#spectrum 1.96616e39*x^5 - 0.00204264e36*x^4 + 0.834378e27*x^3 - 167.958e18*x^2 + 16674.8e9*x - 639317 # UCN spectrum in horizontal guide from FRM2 source

#Emin 5.5e-9
#Emax 85e-9
#spectrum 1.986*(x*1e9 - 5.562)*(1 - tanh(0.3962*(x*1e9 - 72.72))) # total energy spectrum of UCN in storage volume after cleaning

#Emin 20e-9
#Emax 115e-9
#spectrum 0.7818*(x*1e9 - 24.842)*(1 - tanh(0.2505*(x*1e9 - 97.510))) # total energy spectrum of low-field-seekers in storage volume after ramping

#Emin 0
#Emax 751
#spectrum ProtonBetaSpectrum(x)	# ProtonBetaSpectrum is a predefined function for proton energies from free-neutron decay

#Emin 0
#Emax 782e3
#spectrum ElectronBetaSpectrum(x)	# ElectronBetaSpectrum is a predefined function for electron energies from free-neutron decay

#Emin 0
#Emax 1
#spectrum MaxwellBoltzSpectrum(300, x)     # MaxwellBoltzSpectrum is a predefined function for gas molecules (first parameter is the temp. in Kelvin)


# Initial direction of particles
# !! ==> Volume sources only! Surface sources produce velocities cosine(theta)-distributed around the surface normal
phi_v_min -45	# min. azimuth angle of velocity [degree]
phi_v_max 45	# max. azimuth angle of velocity [degree]
phi_v cos(x)		# differential initial distribution of azimuth angle of velocity

theta_v_min 45	 # min. polar angle of velocity [degree]
theta_v_max 135 # max. polar angle of velocity [degree]
theta_v sin(x)
#theta_v sin(x)	# differential initial distribution of polar angle of velocity


polarization 0	# initial polarization is randomly chosen, weighted by this variable (1: low-field-seekers only, -1: high-field-seekers only) [-1..1]


[FIELDS]
########### electric and magnetic fields ##########
# Tabulated maps:
# OPERA2D: a table of field values on a regular 2D grid exported from OPERA. It is assumed that the field is rotationally symmetric around the z axis.
# OPERA3D: a table of field values on a rectilinear 3D grid exported from OPERA
# COMSOL: a generic 3D table of magnetic field values on a rectilinear grid, e.g. exported from COMSOL
# 2D and 3D tables allow to scale coordinates with a given factor. Scaled coordinates are assumed to be in meters.
# Scaled magnetic fields are assumed to be in Tesla, scaled electric potentials in V.
# For 3D tables a BoundaryWidth [m] can be specified within which the field is smoothly brought to zero.
# Paths of table files are assumed to be relative to this config file's path. Table files can be gzip or bzip compressed.
#
# Several analytically calculated fields are available, see description for each field type below.
# All coordinates are defined in meters, currents in ampere, fields in Tesla
#
# Each line is preceded by a unique identifier. Entries with duplicate identifiers will overwrite each other
# For each field a time-dependent scaling factor (can be defined in the FORMULAS section) can be added.
# Note that rapidly changing fields might be missed by the trajectory integrator making too large time steps
##################################################
#3Dfield 	table-file	BFieldScale	BoundaryWidth	CoordinateScale
# 4 COMSOL	fields/meshes/Bfield_octupole-monoseg-cub-tric_xmin0_xmax2000_hx100_yzmax54_hyz9.txt	1	0	1
# 5 COMSOL	fields/meshes/Bfield_coil-tric_xmin0_xmax2000_hx100_yzmax54_hyz9.txt			1	0	1
# 4 COMSOL	fields/meshes/Bfield_octupole-monoseg-cub-tric_xmin0_xmax2000_hx50_yzmax54_hyz6.txt	1	0	1
# 5 COMSOL	fields/meshes/Bfield_coil-tric_xmin0_xmax2000_hx50_yzmax54_hyz6.txt			1	0	1
# 4 COMSOL	fields/meshes/Bfield_octupole-monoseg-cub-tric_xmin0_xmax2000_hx25_yzmax54_hyz3.txt	1	0	1
# 5 COMSOL	fields/meshes/Bfield_coil-tric_xmin0_xmax2000_hx25_yzmax54_hyz3.txt			1	0	1
# 4 COMSOL	fields/meshes/Bfield_octupole-monoseg-cub-tric_xmin0_xmax2000_hx20_yzmax54_hyz2.txt	1	0	1
# 5 COMSOL	fields/meshes/Bfield_coil-tric_xmin0_xmax2000_hx20_yzmax54_hyz2.txt			1	0	1
# 5 COMSOL	fields/meshes/Bfield_octupole-monoseg-cub-tric_xmin0_xmax2000_hx10_yzmax54_hyz1.txt	1	0	1
# 5 COMSOL	fields/meshes/Bfield_coil-tric_xmin0_xmax2000_hx10_yzmax54_hyz1.txt			1	0	1
# 5 COMSOL	fields/meshes/Bfield_octupole-monoseg-tra-tric_xmin0_xmax2000_hx10_yzmax54_hyz1.txt	1	0	1

# 5 COMSOL	fields/meshes/Bfield_octupole-monoseg-cyl-tric_xmin0_xmax2000_hx10_yzmax54_hyz1.txt	1	0	1


# 4 TRICUBIC	fields/meshes/Bfield_octupole-monoseg-cub-tric_xmin0_xmax2000_hx100_yzmax54_hyz9.txt	1	0	1
# 5 TRICUBIC	fields/meshes/Bfield_coil-tric_xmin0_xmax2000_hx100_yzmax54_hyz9.txt			1	0	1
# 4 TRICUBIC	fields/meshes/Bfield_octupole-monoseg-cub-tric_xmin0_xmax2000_hx50_yzmax54_hyz6.txt	1	0	1
# 5 TRICUBIC	fields/meshes/Bfield_coil-tric_xmin0_xmax2000_hx50_yzmax54_hyz6.txt			1	0	1
# 4 TRICUBIC	fields/meshes/Bfield_octupole-monoseg-cub-tric_xmin0_xmax2000_hx25_yzmax54_hyz3.txt	1	0	1
# 5 TRICUBIC	fields/meshes/Bfield_coil-tric_xmin0_xmax2000_hx25_yzmax54_hyz3.txt	1	0	1
# 4 TRICUBIC	fields/meshes/Bfield_octupole-monoseg-cub-tric_xmin0_xmax2000_hx20_yzmax54_hyz2.txt	1	0	1
# 5 TRICUBIC	fields/meshes/Bfield_coil-tric_xmin0_xmax2000_hx20_yzmax54_hyz2.txt			1	0	1
4 TRICUBIC	fields/meshes/Bfield_octupole-monoseg-cub-tric_xmin0_xmax2000_hx10_yzmax54_hyz1.txt	1	0	1
5 TRICUBIC	fields/meshes/Bfield_coil-tric_xmin0_xmax2000_hx10_yzmax54_hyz1.txt			1	0	1


# 4 TRICUBIC	fields/meshes/Bfield_octupole-monoseg-tra-tric_xmin0_xmax2000_hx10_yzmax54_hyz1.txt	1	0	1
# 4 TRICUBIC	fields/meshes/Bfield_octupole-monoseg-cyl-tric_xmin0_xmax2000_hx10_yzmax54_hyz1.txt	1	0	1

## delta = 1 octupole
# 4 TRICUBIC	fields/meshes/Bfield_octupole-tra-tric_delta1_xmin0_xmax2000_hx25_yzmax54_hyz3.txt	1	0	1




## Pyrhon fields calculates the three field components from magnet (for example magpy object) provided in .py file.
# Each component can depend on the spatial coordinates x, y, z and a time variable t. Field derivatives are approximated numerically using a five-point stencil method.
# Python source can be static (Temporal = 0) or time-depend (Temporal=1). 
# The field is only evaluated within x/y/z min/max boundaries. If a BoundaryWidth is defined, the field will be brought smoothly to zero at these boundaries.

#file-type 	magpy-file	Temporal xmax  xmin  ymax   ymin    zmax   zmin     Bscale
# 17 PythonField	octupole		1	 0
# 18 PythonField	coil			1	0
# 18 PythonField	SF2	1	1.1   0.8   0.054  -0.054  0.054  -0.054   1


# Simulate magnetic field from a current I flowing from a list of points (x1, y1, z1) to (x2, y2, z2)
#ECurrentField	    	file   	 	   	   	current xmax  xmin  ymax   ymin    zmax   zmin     Bscale
# 10 ECurrentField	fields/spinflip/SF2.1-k4.txt	I2.1	1.1   0.9   0.054  -0.054  0.054  -0.054   1
# 11 ECurrentField	fields/spinflip/SF2.2-k4.txt	I2.2	1.1   0.9   0.054  -0.054  0.054  -0.054   1


## CustomBField calculates the three field components from formulas defined in the FORMULAS section.
# Each component can depend on the spatial coordinates x, y, z and a time variable t. Field derivatives are approximated numerically using a five-point stencil method.
# The field is only evaluated within x/y/z min/max boundaries. If a BoundaryWidth is defined, the field will be brought smoothly to zero at these boundaries.

# CustomBField Bx-formula By-formula Bz-formula xmax xmin ymax ymin zmax zmin BoundaryWidth scale
#15 CustomBField Bx By Bz 0.054 -0.054 0.054 -0.054 1.055 0.905 0 1


######### default values for particle-specific settings ############
[PARTICLES]
tau 0				# exponential decay lifetime [s], 0: no decay
tmax 9e99			# max simulation time [s]
lmax 9e99			# max trajectory length [m]

######### Logging options. You can add or remove any of the listed variables in the *logvars lists, or any combination defined in a formula in the FORMULAS section #######
######### If the *logfilter option is set to a formula in the FORMULAS section, the particle will only be logged if the result of the formula returns true          #######
endlog 1			# print initial and final state to file [0/1]
endlogvars jobnumber particle tstart xstart ystart zstart vxstart vystart vzstart polstart Sxstart Systart Szstart Hstart Estart Bstart Ustart solidstart tend xend yend zend vxend vyend vzend polend Sxend Syend Szend Hend Eend Bend Uend solidend stopID Nspinflip spinflipprob Nhit Nstep trajlength Hmax wL
endlogfilter

tracklog 1			# print complete trajectory to file [0/1]
tracklogvars jobnumber particle polarisation t x y z vx vy vz H E Bx dBxdx dBxdy dBxdz By dBydx dBydy dBydz Bz dBzdx dBzdy dBzdz Ex Ey Ez V
trackloginterval 1e-2	# min. distance interval [m] between track points in tracklog file
tracklogfilter

hitlog 1			# print geometry hits to file [0/1]
hitlogvars jobnumber particle t x y z v1x v1y v1z pol1 v2x v2y v2z pol2 nx ny nz solid1 solid2
hitlogfilter

snapshotlog 0		# print initial state and state at certain times to file [0/1]
snapshots 0 10 20 30 40 50 60 70 80 90 100 110 120 130 140 150 160 170 180 190 200 210 220 230 240 250 260 270 280 290 300 310 320 330 340 350 360 370 380 390 400 410 420 430 440 450 460 470 480 490 500 510 520 530 540 550 560 570 580 590 600 610 620 630 640 650 660 670 680 690 700 710 720 730 740 750 760 770 780 790 800 810 820 830 840 850 860 870 880 890 900 910 920 930 940 950 960 970 980 990 1000 # times [s] at which to take snapshots
snapshotlogvars jobnumber particle tstart xstart ystart zstart vxstart vystart vzstart polstart Sxstart Systart Szstart Hstart Estart Bstart Ustart solidstart tend xend yend zend vxend vyend vzend polend Sxend Syend Szend Hend Eend Bend Uend solidend stopID Nspinflip spinflipprob Nhit Nstep trajlength Hmax wL
snapshotlogfilter

spinlog 0			# print spin trajectory to file [0/1]
spinlogvars jobnumber particle t x y z Sx Sy Sz Wx Wy Wz Bx By Bz
spinloginterval 5e-8 # min. time interval [s] between track points in spinlog file
spinlogfilter
spintimes	0 700	# do spin tracking between these points in time [s]
Bmax 0.0			# do spin tracking when absolute magnetic field is below this value [T]
flipspin 0			# do Monte Carlo spin flips when magnetic field surpasses Bmax [0/1]
interpolatefields 0	# Interpolate magnetic and electric fields for spin tracking between trajectory step points [0/1]. This will speed up spin tracking in high magnetic fields, but might break spin tracking in weak, quickly oscillating fields!


############# set options for individual particle types, overwrites above settings ###############
[neutron]
tau 880.1

[proton]
tmax 3e-3

[electron]
tmax 1e-5

[mercury]

[xenon]


############ define formulas used for CustomBField or output to log files
## see the supported syntax in the ExprTk documentation at http://partow.net/programming/exprtk/index.html
[FORMULAS]


# # spinflippers
I2.1 22*sin(38314864*t)
I2.2 22*cos(38314864*t)

